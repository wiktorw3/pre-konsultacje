<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo - OÅ› czasu procesu legislacji</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', sans-serif;
            margin: 0;
            padding: 2rem;
            background: #f5f5f5;
            line-height: 1.6;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            margin-top: 0;
            color: #111827;
        }
    </style>
    <link rel="stylesheet" href="Timeline.css">
</head>
<body>
    <div id="root"></div>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Ikony dla kaÅ¼dego etapu
        const stageIcons = {
            'Prekonsultacje': 'ðŸ’­',
            'Projekt': 'âœï¸',
            'Konsultacje': 'ðŸ—£ï¸',
            'Ustawa': 'ðŸ“„',
            'GÅ‚osowanie w Sejmie': 'ðŸ—³ï¸',
            'GÅ‚osowanie w Senacie': 'âš–ï¸',
            'Decyzja Prezydenta': 'âœ’ï¸'
        };

        // Mapowanie etapÃ³w na klasy CSS (kaÅ¼dy etap ma swÃ³j kolor)
        const stageClasses = {
            'Prekonsultacje': 'timeline-stage--prekonsultacje',
            'Projekt': 'timeline-stage--projekt',
            'Konsultacje': 'timeline-stage--konsultacje',
            'Ustawa': 'timeline-stage--ustawa',
            'GÅ‚osowanie w Sejmie': 'timeline-stage--sejm',
            'GÅ‚osowanie w Senacie': 'timeline-stage--senat',
            'Decyzja Prezydenta': 'timeline-stage--prezydent'
        };

        const statusClasses = {
            'preparing': 'timeline-stage--preparing',
            'consultations': 'timeline-stage--consultations',
            'passed': 'timeline-stage--passed',
            'risks': 'timeline-stage--risks'
        };

        function getStatusLabel(status) {
            const labels = {
                'preparing': 'W przygotowaniu',
                'consultations': 'W konsultacjach',
                'passed': 'Uchwalona',
                'risks': 'Ryzyka wdroÅ¼eniowe'
            };
            return labels[status] || 'Nieznany';
        }

        function Timeline({ data = [], onStageClick }) {
            const [activeTooltip, setActiveTooltip] = useState(null);
            const [selectedStage, setSelectedStage] = useState(null);
            const modalRef = useRef(null);
            const previousActiveElementRef = useRef(null);

            const handleStageClick = (stage, event) => {
                event.preventDefault();
                previousActiveElementRef.current = document.activeElement;
                setSelectedStage(stage);
                if (onStageClick) {
                    onStageClick(stage);
                }
            };

            const handleKeyDown = (stage, event) => {
                if (event.key === 'Enter' || event.key === ' ') {
                    event.preventDefault();
                    handleStageClick(stage, event);
                }
            };

            const closeModal = () => {
                setSelectedStage(null);
                if (previousActiveElementRef.current) {
                    previousActiveElementRef.current.focus();
                }
            };

            const handleModalKeyDown = (event) => {
                if (event.key === 'Escape') {
                    closeModal();
                }
            };

            useEffect(() => {
                if (selectedStage && modalRef.current) {
                    const closeButton = modalRef.current.querySelector('.timeline-modal-close');
                    if (closeButton) {
                        closeButton.focus();
                    }
                }
            }, [selectedStage]);

            const orderedStages = [
                'Prekonsultacje',
                'Projekt',
                'Konsultacje',
                'Ustawa',
                'GÅ‚osowanie w Sejmie',
                'GÅ‚osowanie w Senacie',
                'Decyzja Prezydenta'
            ];

            const sortedData = orderedStages
                .map(stageName => data.find(item => item.stage === stageName))
                .filter(Boolean);

            if (sortedData.length === 0) {
                return (
                    <div className="timeline-container" role="status" aria-live="polite">
                        <p>Brak danych do wyÅ›wietlenia</p>
                    </div>
                );
            }

            return (
                <>
                    <div className="timeline-container" role="region" aria-label="OÅ› czasu procesu legislacji">
                        <div className="timeline-line" aria-hidden="true"></div>
                        <ol className="timeline-list" role="list">
                            {sortedData.map((item, index) => {
                                const stageClass = stageClasses[item.stage] || '';
                                const isLast = index === sortedData.length - 1;
                                const stageId = `stage-${index}`;

                                return (
                                    <li
                                        key={item.stage}
                                        className={`timeline-item ${isLast ? 'timeline-item--last' : ''}`}
                                        role="listitem"
                                    >
                                        <button
                                            className={`timeline-stage ${stageClass}`}
                                            onClick={(e) => handleStageClick(item, e)}
                                            onKeyDown={(e) => handleKeyDown(item, e)}
                                            onMouseEnter={() => setActiveTooltip(index)}
                                            onMouseLeave={() => setActiveTooltip(null)}
                                            onFocus={() => setActiveTooltip(index)}
                                            onBlur={() => setActiveTooltip(null)}
                                            aria-label={`${item.stage}, status: ${getStatusLabel(item.status)}. Kliknij, aby zobaczyÄ‡ szczegÃ³Å‚y.`}
                                            aria-describedby={`tooltip-${index}`}
                                            id={stageId}
                                        >
                                            <span className="timeline-stage-icon" aria-hidden="true">
                                                {stageIcons[item.stage] || 'â€¢'}
                                            </span>
                                            <span className="timeline-stage-label">{item.stage}</span>
                                            <span className="timeline-stage-indicator" aria-hidden="true"></span>
                                        </button>

                                        {/* Tooltip - tylko opis w prostym jÄ™zyku */}
                                        {activeTooltip === index && (item.osrSummary || item.description) && (
                                            <div
                                                id={`tooltip-${index}`}
                                                className="timeline-tooltip"
                                                role="tooltip"
                                                aria-live="polite"
                                            >
                                                <p className="timeline-tooltip-description">
                                                    {item.osrSummary || item.description}
                                                </p>
                                            </div>
                                        )}

                                        {/* StrzaÅ‚ka do nastÄ™pnego etapu */}
                                        {!isLast && (
                                            <div className="timeline-arrow" aria-hidden="true">
                                                â†’
                                            </div>
                                        )}
                                    </li>
                                );
                            })}
                        </ol>
                    </div>

                    {selectedStage && (
                        <div
                            className="timeline-modal-overlay"
                            onClick={closeModal}
                            onKeyDown={handleModalKeyDown}
                            role="dialog"
                            aria-modal="true"
                            aria-labelledby="modal-title"
                        >
                            <div
                                ref={modalRef}
                                className="timeline-modal"
                                onClick={(e) => e.stopPropagation()}
                                role="document"
                            >
                                <button
                                    className="timeline-modal-close"
                                    onClick={closeModal}
                                    aria-label="Zamknij okno szczegÃ³Å‚Ã³w"
                                >
                                    Ã—
                                </button>
                                <h2 id="modal-title" className="timeline-modal-title">
                                    {selectedStage.stage}
                                </h2>
                                <div className="timeline-modal-content">
                                    <div className="timeline-modal-section">
                                        <h3>Status</h3>
                                        <span className={`timeline-status-badge ${statusClasses[selectedStage.status]}`}>
                                            {getStatusLabel(selectedStage.status)}
                                        </span>
                                    </div>
                                    
                                    {selectedStage.projectName && (
                                        <div className="timeline-modal-section">
                                            <h3>Nazwa projektu</h3>
                                            <p>{selectedStage.projectName}</p>
                                        </div>
                                    )}

                                    {selectedStage.ministry && (
                                        <div className="timeline-modal-section">
                                            <h3>Ministerstwo</h3>
                                            <p>{selectedStage.ministry}</p>
                                        </div>
                                    )}

                                    {selectedStage.osrSummary && (
                                        <div className="timeline-modal-section">
                                            <h3>SkrÃ³t OSR (w prostym jÄ™zyku)</h3>
                                            <p>{selectedStage.osrSummary}</p>
                                        </div>
                                    )}

                                    {selectedStage.description && (
                                        <div className="timeline-modal-section">
                                            <h3>Opis</h3>
                                            <p>{selectedStage.description}</p>
                                        </div>
                                    )}

                                    {selectedStage.link && (
                                        <div className="timeline-modal-section">
                                            <a
                                                href={selectedStage.link}
                                                className="timeline-modal-link"
                                                target="_blank"
                                                rel="noopener noreferrer"
                                            >
                                                Zobacz dokumenty â†’
                                            </a>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}
                </>
            );
        }

        // PrzykÅ‚adowe dane
        const exampleTimelineData = [
            {
                stage: 'Prekonsultacje',
                status: 'passed',
                description: 'Etap wstÄ™pnych konsultacji spoÅ‚ecznych i analiz.',
                link: 'https://www.gov.pl/web/prekonsultacje',
                projectName: 'Ustawa o wspieraniu innowacyjnoÅ›ci',
                ministry: 'Ministerstwo Rozwoju i Technologii',
                osrSummary: 'WstÄ™pny etap przygotowywania projektu ustawy. KaÅ¼dy moÅ¼e zgÅ‚aszaÄ‡ pomysÅ‚y i opinie, aby sprawdziÄ‡ moÅ¼liwe skutki zmian.'
            },
            {
                stage: 'Projekt',
                status: 'passed',
                description: 'Przygotowanie projektu ustawy przez ministerstwo.',
                link: 'https://www.gov.pl/web/dziennik-ustaw',
                projectName: 'Ustawa o wspieraniu innowacyjnoÅ›ci',
                ministry: 'Ministerstwo Rozwoju i Technologii',
                osrSummary: 'Tworzony jest oficjalny projekt ustawy. Zawiera treÅ›Ä‡ przepisÃ³w, cele i uzasadnienie dla zmian.'
            },
            {
                stage: 'Konsultacje',
                status: 'consultations',
                description: 'Publiczne konsultacje projektu ustawy - moÅ¼liwoÅ›Ä‡ skÅ‚adania uwag.',
                link: 'https://www.gov.pl/web/konsultacje-spoleczne',
                projectName: 'Ustawa o wspieraniu innowacyjnoÅ›ci',
                ministry: 'Ministerstwo Rozwoju i Technologii',
                osrSummary: 'Projekt ustawy jest udostÄ™pniany gÅ‚Ã³wnym interesariuszom â€“ organizacjom, instytucjom i grupom, ktÃ³re sÄ… najbardziej zwiÄ…zane z tematem ustawy. MogÄ… zgÅ‚aszaÄ‡ uwagi i sugestie zmian.'
            },
            {
                stage: 'Ustawa',
                status: 'consultations',
                description: 'Projekt ustawy przekazany do dalszych prac legislacyjnych.',
                link: 'https://www.sejm.gov.pl',
                projectName: 'Ustawa o wspieraniu innowacyjnoÅ›ci',
                ministry: 'Ministerstwo Rozwoju i Technologii',
                osrSummary: 'Projekt zostaje przyjÄ™ty przez rzÄ…d i oficjalnie skierowany do Sejmu jako projekt ustawy.'
            },
            {
                stage: 'GÅ‚osowanie w Sejmie',
                status: 'preparing',
                description: 'Projekt ustawy w trakcie procedowania w Sejmie RP.',
                link: 'https://www.sejm.gov.pl/Sejm9.nsf/agent.xsp?symbol=posglosowania',
                projectName: 'Ustawa o wspieraniu innowacyjnoÅ›ci',
                ministry: 'Ministerstwo Rozwoju i Technologii',
                osrSummary: 'PosÅ‚owie gÅ‚osujÄ… nad projektem ustawy. JeÅ›li wiÄ™kszoÅ›Ä‡ posÅ‚Ã³w go popiera, ustawa przechodzi do Senatu.'
            },
            {
                stage: 'GÅ‚osowanie w Senacie',
                status: 'preparing',
                description: 'Ustawa po uchwaleniu przez Sejm trafia do Senatu.',
                link: 'https://www.senat.gov.pl',
                projectName: 'Ustawa o wspieraniu innowacyjnoÅ›ci',
                ministry: 'Ministerstwo Rozwoju i Technologii',
                osrSummary: 'Senat moÅ¼e zaakceptowaÄ‡ ustawÄ™ w caÅ‚oÅ›ci, wprowadziÄ‡ poprawki lub zgÅ‚osiÄ‡ uwagi. Poprawki Senatu wracajÄ… do Sejmu do ostatecznego rozpatrzenia.'
            },
            {
                stage: 'Decyzja Prezydenta',
                status: 'risks',
                description: 'Ostatni etap - Prezydent podpisuje ustawÄ™ lub jÄ… zawetuje.',
                link: 'https://www.prezydent.pl',
                projectName: 'Ustawa o wspieraniu innowacyjnoÅ›ci',
                ministry: 'Ministerstwo Rozwoju i Technologii',
                osrSummary: 'Prezydent moÅ¼e: PodpisaÄ‡ ustawÄ™, wtedy wchodzi w Å¼ycie. ZawetowaÄ‡ ustawÄ™, wtedy wraca do Sejmu, ktÃ³ry moÅ¼e odrzuciÄ‡ weto wiÄ™kszoÅ›ciÄ… 3/5 gÅ‚osÃ³w w obecnoÅ›ci co najmniej poÅ‚owy posÅ‚Ã³w. ZwrÃ³ciÄ‡ ustawÄ™ do TrybunaÅ‚u Konstytucyjnego w sprawie zgodnoÅ›ci z konstytucjÄ….'
            }
        ];

        function App() {
            const handleStageClick = (stage) => {
                console.log('KlikniÄ™to etap:', stage.stage);
            };

            return (
                <div className="container">
                    <h1>OÅ› czasu procesu legislacji</h1>
                    <Timeline data={exampleTimelineData} onStageClick={handleStageClick} />
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

